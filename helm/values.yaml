# Default values for marketplace-api.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

nameOverride: ""
fullnameOverride: ""

imagePullSecrets:
  - name: ghcr-creds

global:
  imageTag: "latest"

services:
  - name: "pxm-api"
    replicaCount: 1
    image:
      repository: ghcr.io/kobeosoft/marketplace/api/pxm
    service:
      port: 3000
    route:
        uriPrefix: "/api/pxm"
        uriRewrite: "/"
        port: 3000

postgresql:
  enabled: true
  image:
    tag: "latest"  # Ou une version sp√©cifique
  postgresqlUsername: ""
  postgresqlPassword: ""
  postgresqlDatabase: "default"
  persistence:
    enabled: true
    storageClass: ""
    accessModes:
      - ReadWriteOnce
    size: "10Gi"
  initdbScripts:
    init-db.sql: |
      {{- .Files.Get "files/sql/init-db.sql" | nindent 6 }}

redis:
  ## Redis settings
  auth:
    enabled: true
    password: "admin"

  ## Redis master settings
  master:
    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "200m"
    persistence:
      enabled: true
      path: /data
      size: "8Gi"  # Adjust based on your needs
      storageClass: ""  # Leave blank for default, or specify storage class

  ## Redis replica settings
  replica:
    replicaCount: 2  # Number of Redis replicas
    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "200m"
    persistence:
      enabled: true
      path: /data
      size: "8Gi"  # Adjust based on your needs
      storageClass: ""  # Leave blank for default, or specify storage class

  ## Network policy settings
  networkPolicy:
    enabled: false

  ## Additional configuration
  configmap: |
    maxmemory-policy: "volatile-lru"
    # Add other Redis configurations as needed

typesense:
  replicaCount: 1
  resources:
    requests:
      memory: "1Gi"
      cpu: "100m"
    limits:
      memory: "2Gi"
      cpu: "500m"

keycloak:
  auth:
    adminUser: ""
    adminPassword: ""
  persistence:
    deployPostgres: false
    dbVendor: postgres
    dbName: keycloak
    dbHost: "postgresql.{{ .Release.Namespace }}.svc.cluster.local"
    dbPort: 25060
    dbUser: ""
    dbPassword: ""


serviceAccount:
  create: false
  automount: true
  annotations: {}
  name: ""

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80
